#!/bin/bash
############################################
##FIRST STEP: INSTALL DEPENDECIES & TOOLS ##
############################################
##UPGRADE AND UPDATE UBUNTU
sudo apt-get update
sudo apt-get upgrade
##INSTALL POSTGRES PYTHON NPM NODEJS GIT LESS & OTHER ODOO DEPENDECIES
sudo apt-get update && sudo apt-get install postgresql postgresql-server-dev-10 build-essential python3-pil python3-lxml python-ldap3 python3-dev python3-pip python3-setuptools npm nodejs git gdebi libldap2-dev libsasl2-dev  libxml2-dev libxslt1-dev libjpeg-dev -y
sudo apt install git  python-all-dev python-dev python-setuptools libxml2-dev libxslt1-dev libevent-dev libsasl2-dev libldap2-dev pkg-config libtiff5-dev libjpeg8-dev libjpeg-dev zlib1g-dev libfreetype6-dev liblcms2-dev liblcms2-utils libwebp-dev tcl8.6-dev tk8.6-dev python-tk libyaml-dev fontconfig -y
pip3 install suds-py3
pip3 install image
sudo npm install -g less less-plugin-clean-css -y && sudo ln -s /usr/bin/nodejs /usr/bin/node
##############################################
##SECOND STEP:ODOO INSTALLATION AND CONFIG ##
##############################################
##CREATE ODOO USER AND GROUP
sudo adduser --system --quiet --shell=/bin/bash --home=/opt/odoo --gecos 'odoo' --group odoo
##CRAETE ODOO FILE STRUCTURE
sudo mkdir /etc/odoo && sudo mkdir /var/log/odoo/
##ODOO 12 DOWNLOAD:
sudo git clone --depth 1 --branch 12.0 https://github.com/odoo/odoo /opt/odoo/odoo
##ODOO DIRECTORY PERMISSIONS & CORE REQUIERMENTS INSTALLATION
sudo chown odoo:odoo /opt/odoo/ -R && sudo chown odoo:odoo /var/log/odoo/ -R && cd /opt/odoo/odoo && sudo pip3 install -r requirements.txt
##DOWNLOAD WKHTMLTOPDF (PDF GENERATOR)
sudo apt install xfonts-base xfonts-75dpi -y
cd /tmp
wget http://security.ubuntu.com/ubuntu/pool/main/libp/libpng/libpng12-0_1.2.54-1ubuntu1.1_amd64.deb && sudo dpkg -i libpng12-0_1.2.54-1ubuntu1.1_amd64.deb
wget https://downloads.wkhtmltopdf.org/0.12/0.12.5/wkhtmltox_0.12.5-1.bionic_amd64.deb && sudo dpkg -i wkhtmltox_0.12.5-1.bionic_amd64.deb
sudo ln -s /usr/local/bin/wkhtmltopdf /usr/bin/
sudo ln -s /usr/local/bin/wkhtmltoimage /usr/bin/
##CREATE DATABASE USER:
sudo su - postgres -c "createuser -s odoo"
##ODOO CONFIGURATION:
sudo su - odoo -c "/opt/odoo/odoo/odoo-bin --addons-path=/opt/odoo/odoo/addons -s --stop-after-init"
##CREATE ODOO CONFIG FILE:
sudo mv /opt/odoo/.odoorc /etc/odoo/odoo.conf
##ADD PARAMETERS TO ODOO SONFIG FILE
sudo sed -i "s,^\(logfile = \).*,\1"/var/log/odoo/odoo-server.log"," /etc/odoo/odoo.conf
##CREATE ODOO STARTUP SERVICE FILE
sudo cp /opt/odoo/odoo/debian/init /etc/init.d/odoo && sudo chmod +x /etc/init.d/odoo
sudo ln -s /opt/odoo/odoo/odoo-bin /usr/bin/odoo
sudo update-rc.d -f odoo start 20 2 3 4 5 .
sudo service odoo start
###########################################
##THIRD STEP:ODOO OCA MODULES AND ADDONS ##
###########################################
##DOWNLOAD OCA DEPENDENCIES
sudo mkdir /../opt/odoo/odoo/OCA_addons/FE_plug
sudo git clone https://github.com/odoocr/l10n_cr --depth 1 --branch 12.0 --single-branch /../opt/odoo/odoo/OCA_addons/FE_plug
sudo mkdir /../opt/odoo/odoo/OCA_addons/account-invoice
sudo git clone https://github.com/OCA/account-invoicing --depth 1 --branch 12.0 --single-branch /../opt/odoo/odoo/OCA_addons/account-invoice
sudo mkdir /../opt/odoo/odoo/OCA_addons/server-ux
sudo git clone https://github.com/OCA/server-ux --depth 1 --branch 12.0 --single-branch /../opt/odoo/odoo/OCA_addons/server-ux
sudo mkdir /../opt/odoo/odoo/OCA_addons/account-financial-tools
sudo git clone https://github.com/OCA/account-financial-tools --depth 1 --branch 12.0 --single-branch /../opt/odoo/odoo/OCA_addons/account-financial-tools
sudo mkdir /../opt/odoo/odoo/OCA_addons/bank-payment
sudo git clone https://github.com/OCA/bank-payment --depth 1 --branch 12.0 --single-branch /../opt/odoo/odoo/OCA_addons/bank-payment
sudo mkdir /../opt/odoo/odoo/OCA_addons/account-payment
sudo git clone https://github.com/OCA/account-payment --depth 1 --branch 12.0 --single-branch /../opt/odoo/odoo/OCA_addons/account-payment
sudo mkdir /../opt/odoo/odoo/OCA_addons/community-data-files
sudo git clone https://github.com/OCA/community-data-files --depth 1 --branch 12.0 --single-branch /../opt/odoo/odoo/OCA_addons/community-data-files
sudo mkdir /../opt/odoo/odoo/OCA_addons/currency
sudo git clone https://github.com/OCA/currency --depth 1 --branch 12.0 --single-branch /../opt/odoo/odoo/OCA_addons/currency
sudo mkdir /../opt/odoo/odoo/OCA_addons/partner-contact
sudo git clone https://github.com/OCA/partner-contact --depth 1 --branch 12.0 --single-branch /../opt/odoo/odoo/OCA_addons/partner-contact
sudo mkdir /../opt/odoo/odoo/OCA_addons/server-tools
sudo git clone https://github.com/OCA/server-tools --depth 1 --branch 12.0 --single-branch /../opt/odoo/odoo/OCA_addons/server-tools
sudo mkdir /../opt/odoo/odoo/OCA_addons/sale-workflow 
sudo git clone https://github.com/OCA/sale-workflow --depth 1 --branch 12.0 --single-branch /../opt/odoo/odoo/OCA_addons/sale-workflow 
sudo mkdir /../opt/odoo/odoo/OCA_addons/edi
sudo git clone https://github.com/OCA/edi --depth 1 --branch 12.0 --single-branch /../opt/odoo/odoo/OCA_addons/edi
sudo mkdir /../opt/odoo/odoo/OCA_addons/queue
sudo git clone https://github.com/OCA/queue --depth 1 --branch 12.0 --single-branch /../opt/odoo/odoo/OCA_addons/queue
sudo mkdir /../opt/odoo/odoo/OCA_addons/web-oca
sudo git clone https://github.com/OCA/web --depth 1 --branch 12.0 --single-branch /../opt/odoo/odoo/OCA_addons/web-oca
sudo mkdir /../opt/odoo/odoo/OCA_addons/connector-telephony
sudo git clone https://github.com/OCA/connector-telephony --depth 1 --branch 12.0 --single-branch /../opt/odoo/odoo/OCA_addons/connector-telephony
##INSTALL COMMUNITY DATA FILES MODULE REQUIREMENTS
sudo pip3 install -r /../opt/odoo/odoo/OCA_addons/community-data-files/requirements.txt
##INSTALL SERVER TOOLS MODULE REQUIREMENTS
sudo pip3 install -r /../opt/odoo/odoo/OCA_addons/server-tools/requirements.txt
##INSTALL CONNECTOR TELEPHONY TOOLS MODULE REQUIREMENTS 
sudo pip3 install -r /../opt/odoo/odoo/OCA_addons/connector-telephony/requirements.txt
##INSTALL FE_PLUG TOOLS MODULE REQUIREMENTS
sudo pip3 install -r /opt/odoo/odoo/OCA_addons/FE_plug/requirements.txt
##REPLACE CONFIG FILES WITH PRE BIULD FILE
sudo mkdir /../home/ubuntu/Pre_Build_Conf
sudo git clone https://ufano:Q$%Fundora0589@github.com/Ufano/devtestcon /../home/ubuntu/Pre_Build_Conf
sudo rm -r /../etc/odoo/odoo.conf
sudo mv /../home/ubuntu/Pre_Build_Conf/odoo.confg.txt /../home/ubuntu/Pre_Build_Conf/odoo.conf
sudo mv /../home/ubuntu/Pre_Build_Conf/odoo.conf /../etc/odoo
sudo reboot
########################################
#####################################
#################################
###    CONFIG FILES PATH
#################################
###ODOO CONFIG####
##/etc/odoo/odoo.config
#################################
#####################################################
##            OCA MODULE ADDONS PATHS
#####################################################
##/../opt/odoo/odoo/OCA_addons/account-invoice
##/../opt/odoo/odoo/OCA_addons/server-ux
##/../opt/odoo/odoo/OCA_addons/account-financial-tools
##/../opt/odoo/odoo/OCA_addons/bank-payment
##/../opt/odoo/odoo/OCA_addons/account-payment
##/../opt/odoo/odoo/OCA_addons/community-data-files
##/../opt/odoo/odoo/OCA_addons/currency
##/../opt/odoo/odoo/OCA_addons/partner-contact
##/../opt/odoo/odoo/OCA_addons/server-tools
##/../opt/odoo/odoo/OCA_addons/sale-workflow 
##/../opt/odoo/odoo/OCA_addons/edi
##/../opt/odoo/odoo/OCA_addons/queue
##/../opt/odoo/odoo/OCA_addons/web-oca
##/../opt/odoo/odoo/OCA_addons/connector-telephony
##/../opt/odoo/odoo/OCA_addons/FE_plug
##Added to odoo config File
##/../opt/odoo/odoo/OCA_addons/account-invoice,/../opt/odoo/odoo/OCA_addons/server-ux,/../opt/odoo/odoo/OCA_addons/account-financial-tools,/../opt/odoo/odoo/OCA_addons/bank-payment,/../opt/odoo/odoo/OCA_addons/account-payment,/../opt/odoo/odoo/OCA_addons/community-data-files,/../opt/odoo/odoo/OCA_addons/currency,/../opt/odoo/odoo/OCA_addons/partner-contact,/../opt/odoo/odoo/OCA_addons/server-tools,/../opt/odoo/odoo/OCA_addons/sale-workflow,/../opt/odoo/odoo/OCA_addons/edi,/../opt/odoo/odoo/OCA_addons/queue,/../opt/odoo/odoo/OCA_addons/web-oca,/../opt/odoo/odoo/OCA_addons/connector-telephony,/../opt/odoo/odoo/OCA_addons/FE_plug
################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################
##Dr.Giro Ufano#################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################
###############Dr.Giro Ufano####################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################
############################Dr.Giro Ufano#######################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################
#########################################Dr.Giro Ufano#######################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################
################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################